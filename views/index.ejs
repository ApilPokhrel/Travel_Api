<!DOCTYPE html>
<html>
<head>
	<title></title>
	 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
	 <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">


<style>

body{
	background-color:rgba(255,74,86,1);/* #f8f8f8*/
	font-family: DosisBold !important;
}

	 	/* .dialog {
  background: #fff;
  border-radius: 5px;
  float: left;
  height: 240px;
  margin: 20px;
  position: relative;
      -webkit-box-shadow: 0 2px 43px -4px rgba(0,0,0,.19);
    box-shadow: 0 2px 43px -4px rgba(0,0,0,.19);
} */




#preview{
    overflow-y: scroll;
    overflow-x: hidden;
    height: 420px;
    width: 100%;

}

#closepreview{
    float: left;
}

#preview img, #preview video{
    width: 400px;
    height: 200px;
}


.filehide{
	display: none !important;
}

.inputStyle {
    width: 100%;
    padding: 12px;
    margin: 5px 0 22px 0;
    border: none;
    background: white;
    font-size: 15px;
    font-weight: 400;
    	font-family: DosisMedium,sans-serif !important;
    color: black;
    border-radius: 4px;

}

.inputStyle:focus {
    background-color: #F6FCB1;
    color: black;
    outline: none;
}

/* Set a style for the submit button */
.btnLogin {
    background-color: #B71D1D;
    color: white;
    padding: 11px 28px;
    border: none;
    cursor: pointer;
    opacity: 0.9;
    border-radius: 20px;
    font-family: DosisExtraBold, sans-serif !important;
    -webkit-box-shadow: 0 2px 43px -4px rgba(0,0,0,.19);
    box-shadow: 0 2px 43px -4px rgba(0,0,0,.19);
    display: inline-block;
    /* float: right; */
    margin-right: 30px;
}

.btnLogin:hover {
    opacity: 1;
    -webkit-box-shadow: none;
    box-shadow: none;
}

.infoform{
/*	border: 2px solid gray;
*/	padding: 30px 40px;
	border-radius: 10px;
	margin-top: 10px;
	background-color: rgba(245,248,252,1); /*rgb(242, 242, 255) rgb(226, 234, 245)*/
	 -webkit-box-shadow: 0 2px 43px -4px rgba(0,0,0,.19);
    box-shadow: 0 2px 43px -4px rgba(0,0,0,.19);
}

.allcont{
	  background:  #ffffff;
      border-radius: 4px;

}

@media only screen and (max-width: 600px) {
   .allcont{
	  background: rgba(245,248,252,1) ;
      border-radius: 0px;
      padding: 0px;

}

.infoform{
	box-shadow: none;
	padding: 25px;
}


.dialog{
height: 150px;

}

.inputStyle{
	 -webkit-box-shadow: 0 2px 43px -4px rgba(0,0,0,.19);
    box-shadow: 0 2px 43px -4px rgba(0,0,0,.19);
}
}


	 </style>
</head>
<body>
	<br><br><br><br>
<div class="container allcont" style="padding-bottom: 30px">

<div class="col-md-4 col-lg-4 col-sm-4 col-xs-12 filecont"> 

    <div class="dialog" style="width: 100%; margin-top: 5px" id="sd">
        <a href="#" class="myButton btn btn-sm btn-white" id="imgBtn">Image</a>
    
        <a href="#" class="myButton btn btn-sm btn-white" id="vidBtn" style="margin-left: 20px;">Video</a>
    <hr>
    <button class="close" id="closepreview">&times;</button> 
        <div id="preview">
       
        </div>
    </div>
    
    


</div>
<br>

	<div class="col-md-7 col-lg-7 col-sm-8 col-xs-12 infoform">
	<form method="POST" id="place_form">
        <input type="file" name="image" accept="image/*"  id="img_file" style="display: none" class="s_file" multiple >
        <input type="file" name="video" accept="video/*" id="vid_file" style="display: none" class="s_file" multiple>
		<div class="form-group">
		<label>Tittle</label>
		<input type="text" name="title" placeholder="your tittle goes here...." required="Please fill out" class="inputStyle">
	</div>
	<div class="form-group">
		<label>Tag</label>
		<input type="text" name="tag" placeholder="your tag goes here...." required="Please fill out" class="inputStyle">
       </div>

       <div class="form-group">
        <label>Contact</label>
        <input type="text" name="contact" placeholder="your Contact goes here...." required="Please fill out" class="inputStyle">
           </div>

       <div class="form-group">
		<label>Address</label>
		<input type="text" name="address" id="address" placeholder="your tag goes here...." required="Please fill Address" class="inputStyle">
       </div>
       <input type="hidden" name="lat" id="lat">
       <input type="hidden" name="lng" id="lng">


       <div class="form-group">
		<label>Description</label>
		<textarea type="text" name="description" placeholder="your description goes here...." required="Please fill out" class="inputStyle"></textarea>
       </div>


  <input type="submit" name="Give" class="btnLogin">

	</form>



</div>
</div>

<div class="container">
    <style>
        body {
  font-family: "Segoe UI", -apple-system, BlinkMacSystemFont, Roboto,
    Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
  line-height: 1.4;
  color: #333;
  background-color: #eee;
}

table {
  margin: 1em 0;
  border-collapse: collapse;
  border: 0.1em solid rgba(0, 0, 0, 0.1);
}

caption {
  text-align: left;
  font-style: italic;
  padding: 0.25em 0.5em 0.5em 0.5em;
}

th,
td {
  padding: 0.25em 0.5em 0.25em 1em;
  vertical-align: text-top;
  text-align: left;
  text-indent: -0.5em;
}

th {
  vertical-align: bottom;
  background-color: rgba(0, 0, 0, 0.1);
}

th[scope=row] {
  vertical-align: top;
}

tr:nth-child(even) {
  background-color: rgba(0, 0, 0, 0.05);
}

tr:nth-child(odd) {
  background-color: rgba(255, 255, 255, 0.05);
}

td:nth-of-type(3) {
  font-style: italic;
}

th:nth-of-type(4),
td:nth-of-type(4) {
  text-align: right;
}

table td > input[type=text], #Sample + table td > button {
  font: inherit;
  border: .1em solid #666;
  width: 7em;
}
        </style>

    <table>
      <caption>Places</caption>
      <thead>
      <tr>
        <th id="ColFlag">SN</th>
        <th id="ColAuthor">Title</th>
        <th id="ColTitle">tag</th>
        <th id="ColYear">description</th>
        <th id="ColISBN13">address</th>
        <th id="ColRemove">Remove</th>
      </tr>
      </thead>
      <tbody>
     
      </tbody>
    </table>
    
   
</div>
</body>

</html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.min.js" ></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script>

function imgPreview(url, x){
    return `<img src="${url}" class="imgmanu" >`;
   } 
  

   function vidPreview(url){
  return `<video id="vid1" style="height: 240px; width:100%; " controls>
     <source src="${url}" id="video_here">
    Your browser does not support HTML5 video.
    </video`;
    }


  var imgfile = document.getElementById("img_file");
  var vidfile = document.getElementById("vid_file");
  var dialog = document.getElementById("sd");
  var preview = document.getElementById("preview");
  var imgBtn = document.getElementById("imgBtn");
  var vidBtn = document.getElementById("vidBtn");
  var close = document.getElementById("closepreview");

preview.style.display = 'none';
close.style.display = 'none';

close.addEventListener("click", function(){
   hide();
});

function hide(){
  preview.style.display = 'none';
  close.style.display = 'none';
  preview.innerHTML = '';
  imgfile.value = null;
  vidfile.value = null;
}

  if(imgfile){
  imgfile.addEventListener("change", function(){
        onChangeImg(this);
  });
    };

  
  imgBtn.addEventListener("click", function(){
  preview.innerHTML = '';
  imgfile.value = null;
    imgfile.click();

  });


  vidBtn.addEventListener("click", function(){
 preview.innerHTML = '';
  vidfile.value = null;
    vidfile.click();

  });


    function onChangeImg(input){
      if(input.files[0]){
          
         var length;

         if(input.files.length < 4){
          
           length = input.files.length;
         }

         else{
          length = 4;
         }

      console.log("length is "+length);
      for(var i= 0; i < length; i++){
        if(input.files[i].size < 1024*1024*50){
        var context = input.files[i].type;
        var str = context.split("/");

        if(str[0] === "image"){

             reader = new FileReader();
        reader.onload = function(e){
         preview.style.display = 'block';
         close.style.display = 'block';
          html = imgPreview(e.target.result, i);
           
          preview.innerHTML += html;
        }

        reader.readAsDataURL(input.files[i]);
        }

        }
      }
      }
    }



    if(vidfile){
      vidfile.addEventListener("change", function(){
           onChangeVid(this);
      });
    };



    function onChangeVid(input){
      if(input.file || input.files[0]){
         if(input.files[0].size < 1024*1024*450){

        var context = input.files[0].type;
        var str = context.split("/");

        if(str[0] === "video"){

           preview.style.display = 'block';
           close.style.display = 'block';
         var html = vidPreview(URL.createObjectURL(input.files[0]));

          preview.innerHTML = html;

         }
        }
      }
     }
    

     $(document).ready(function() {
      $("#place_form").on("submit",function(e){ 
          e.preventDefault();
          uploadFile();
      });
    });

    function uploadFile() {
        let formData = new FormData();
        formData.append("title", $("[name=title]").val());
        formData.append("tag", $("[name=tag]").val());
        formData.append("contact", $("[name=contact]").val());
        formData.append("address", $("[name=address]").val());
        formData.append("lat", $("[name=lat]").val());
        formData.append("lng", $("[name=lng]").val());

        formData.append("description", $("[name=description]").val());
        if(imgfile.files){
            for(var file of imgfile.files){
            formData.append("file", file);
            }
        }else{
            formData.append("file", vidfile.files[0]);
        }

        $.ajax({
        url: `/api/v1/place`,
        type: "POST",
        data: formData,
        enctype: "multipart/form-data",
        headers: {token: $.cookie("token")},
        processData: false,
        contentType: false,
        cache: false,
        success: function(d) {
          alert("File succesfully uploaded", d);
        },
        error: function(e) {
          // Handle upload error
          alert(e.responseText);
        }
      });
    } // func
  


    function fillTable(){
       axios({
          method: 'get',
          url: '/api/v1/place/',
          headers: {token: $.cookie("token")},
          data:{
             limit : 20,
             start: 0
           }
    })
    .then((res)=>{
        if(res.data){
        res.data.map((d, i)=>{  
         $('tbody').append(`<tr>
         <td>${i}</td>
         <th scope="row" id="Row01">${d.title}</th>
         <td>${d.tag}</td>
         <td>${d.description}</td>
         <td>${d.location.address}</td>
         <td><button type="button" onclick="removePlace('${d._id}')" id="b01" aria-labelledby="b01 Row01">Remove</button></td>
         </tr>`);
        }).join(" ");
        } else{
            alert("Invalid place")
        }
    })
   .catch(e => alert(e));
    }


    let removePlace = (id)=>{
        axios({
          method: 'delete',
          url: '/api/v1/place/'+id,
          headers: {token: $.cookie("token")},
    })
    .then((res)=>{
        if(res.data){
            alert("Place removed")

        } else{
            alert("Invalid place")
        }

        window.location.href = "?";
    })
   .catch(e => alert(e));
    }

    fillTable();
</script>

<script
type="text/javascript"
src="https://maps.google.com/maps/api/js?v=3&key=AIzaSyBvExzwwXB7vhWchWY57j91js1EqU7Mssc&libraries=places&callback=myMap"
async
defer
></script>
<script>
window.myMap = function() {
  let input = document.querySelector("#address");
  let latInput = document.querySelector("#lat");
  let lngInput = document.querySelector("#lng");
  if (!input) return;
  const dropdown = new google.maps.places.Autocomplete(input);
  dropdown.addListener("place_changed", () => {
    const place = dropdown.getPlace();
    latInput.value = place.geometry.location.lat();
    lngInput.value = place.geometry.location.lng();
  });
  input.addEventListener("keydown", e => {
    if (e.keyCode === 13) e.preventDefault();
  });
};
</script>